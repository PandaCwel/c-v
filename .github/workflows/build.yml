name: Google Remote Desktop Access

on:
  workflow_dispatch:

jobs:
  setup-remote-desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 720  # 12 godzin

    steps:
      - name: Update and install desktop environment
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies xrdp wget curl unzip

      - name: Install Chrome
        run: |
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb

      - name: Install Chrome Remote Desktop
        run: |
          wget https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb
          sudo apt install -y ./chrome-remote-desktop_current_amd64.deb || sudo apt -f install -y

      - name: Configure Chrome Remote Desktop
        run: |
          sudo usermod -a -G chrome-remote-desktop $USER
          echo "exec startxfce4" > ~/.xsession
          sudo systemctl disable lightdm.service

      - name: Print setup instructions
        run: |
          echo "🔥 Otwórz link poniżej w przeglądarce, zaloguj się na swoje konto Google i skopiuj wygenerowany kod autoryzacyjny:"
          echo ""
          echo "https://remotedesktop.google.com/headless"
          echo ""
          echo "➤ Wybierz 'Debian Linux', potem skopiuj komendę autoryzacyjną i wróć tutaj, by ją wkleić w kolejnym kroku."

      - name: Czekanie na kod autoryzacyjny
        run: |
          echo "✋ Wklej poniżej komendę z Google Remote Desktop (CTRL+V), np:"
          echo "DISPLAY=... bash -"
          echo ""
          read CMD
          eval "$CMD"

      - name: Potwierdzenie działania
        run: echo "✅ CRD powinien być aktywny. Możesz teraz podłączyć się z poziomu https://remotedesktop.google.com/access"
