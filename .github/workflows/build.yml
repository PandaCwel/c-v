name: Google Remote Desktop Access

on:
  workflow_dispatch:

jobs:
  setup-remote-desktop:
    runs-on: ubuntu-latest
    timeout-minutes: 720  # 12 godzin

    steps:
      - name: Update and install desktop environment
        run: |
          sudo apt update
          sudo apt install -y xfce4 xfce4-goodies xrdp wget curl unzip

      - name: Install Chrome
        run: |
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt install -y ./google-chrome-stable_current_amd64.deb

      - name: Install Chrome Remote Desktop
        run: |
          wget https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb
          sudo apt install -y ./chrome-remote-desktop_current_amd64.deb || sudo apt -f install -y

      - name: Configure Chrome Remote Desktop
        run: |
          sudo usermod -a -G chrome-remote-desktop $USER
          echo "exec startxfce4" > ~/.xsession
          sudo systemctl disable lightdm.service

      - name: Print setup instructions
        run: |
          echo "ğŸ”¥ OtwÃ³rz link poniÅ¼ej w przeglÄ…darce, zaloguj siÄ™ na swoje konto Google i skopiuj wygenerowany kod autoryzacyjny:"
          echo ""
          echo "https://remotedesktop.google.com/headless"
          echo ""
          echo "â¤ Wybierz 'Debian Linux', potem skopiuj komendÄ™ autoryzacyjnÄ… i wrÃ³Ä‡ tutaj, by jÄ… wkleiÄ‡ w kolejnym kroku."

      - name: Czekanie na kod autoryzacyjny
        run: |
          echo "âœ‹ Wklej poniÅ¼ej komendÄ™ z Google Remote Desktop (CTRL+V), np:"
          echo "DISPLAY=... bash -"
          echo ""
          read CMD
          eval "$CMD"

      - name: Potwierdzenie dziaÅ‚ania
        run: echo "âœ… CRD powinien byÄ‡ aktywny. MoÅ¼esz teraz podÅ‚Ä…czyÄ‡ siÄ™ z poziomu https://remotedesktop.google.com/access"
